workflow:
  id: dev-qa-cycle
  name: Dev â‡„ QA Story Cycle
  description: >
    Implement a story with the Dev agent and review it with the QA agent,
    repeating until approval.
  type: story-implementation
  sequence:
    - id: dev_implement
      agent: dev
      creates:
        - implementation_files
        - test_files
      requires:
        - docs/stories/{{story_id}}.md
      notes: >
        Use a selected story. Implement the code and tests,
        update DEV_STATUS to "ready_for_QA" and describe the changes
        in the "Dev Notes" section of the story.

    - id: qa_review$SELECTION_PLACEHOLDER$
      agent: qa
      requires:
        - docs/stories/{{story_id}}.md
        - implementation_files
      uses_template: qa-gate-tmpl.yaml
      notes: >
        Run the review-story + qa-gate workflow for this story.
        If everything passes, mark QA_STATUS as "approved".
        If there are issues, set QA_STATUS to "changes_requested"
        and list the items in the "QA Feedback" section.

    - id: dev_fix_feedback
      agent: dev
      condition: qa_status == "changes_requested"
      requires:
        - docs/stories/{{story_id}}.md
      notes: >
        Read the "QA Feedback" section, fix the code and tests,
        mark resolved items and set DEV_STATUS back to "ready_for_QA".

    - id: qa_final
      agent: qa
      condition: qa_status == "changes_requested"
      requires:
        - docs/stories/{{story_id}}.md
      notes: >
        Re-run the review. If everything is OK, mark QA_STATUS as "approved"
        and DEV_STATUS as "done".
