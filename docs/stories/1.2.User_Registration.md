# Story 1.2: User Registration

## Status
Approved

## Story
**As a** new user,
**I want** to register for an account using my email and a password,
**so that** I can access the application.

## Acceptance Criteria
1. A registration endpoint `POST /api/auth/register` exists.
2. It accepts an email and password.
3. It validates that the email is not already in use.
4. It securely hashes and salts the password before storing it in the database.
5. Upon successful registration, a new user record is created with the 'Collaborator' role by default.
6. A success response is returned.

## Tasks / Subtasks
- [ ] Task 1 (AC: 1, 2): Create the `POST /api/auth/register` endpoint in a new `AuthController`.
    - [ ] Subtask 1.1: Create a `RegisterRequest` DTO that accepts `email` and `password`.
- [ ] Task 2 (AC: 3, 4, 5): Implement the registration logic in an `AuthService`.
    - [ ] Subtask 2.1: Check if a user with the given email already exists.
    - [ ] Subtask 2.2: Hash the password using `PasswordEncoder`.
    - [ ] Subtask 2.3: Create a new `User` entity with the `COLLABORATOR` role.
    - [ ] Subtask 2.4: Save the new user to the database using `UserRepository`.
- [ ] Task 3 (AC: 6): Return a success response from the controller.
- [ ] Task 4: Add unit tests for `AuthService`.
- [ ] Task 5: Add integration tests for `AuthController`.

## Dev Notes

### Backend
- **Endpoint:** `POST /api/auth/register` [Source: `docs/architecture/api-specification.md`]
- **Controller:** Create a new `AuthController` to handle this request.
- **Service:** Implement the core logic in an `AuthService`.
- **Security:** Use Spring Security's `PasswordEncoder` for hashing. [Source: `docs/architecture/backend-architecture.md`]
- **Data:** Use the `User` entity and `UserRepository` to interact with the database. The default role is `COLLABORATOR`. [Source: `docs/architecture/data-models.md`, `docs/architecture/backend-architecture.md`]

### Database
- The `users` table must exist with the columns defined in the schema. [Source: `docs/architecture/database-schema.md`]

### Testing
- Unit test the `AuthService` to ensure correct handling of registration logic.
- Integration test the `AuthController` to validate the endpoint. [Source: `docs/architecture/testing-strategy.md`]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-11-05 | 1.0 | Initial draft | Bob (Scrum Master) |
