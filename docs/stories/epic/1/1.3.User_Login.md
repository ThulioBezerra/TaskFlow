# Story 1.3: User Login

## Status
Ready for Review

## Story
**As a** registered user,
**I want** to log in with my email and password,
**so that** I can access my tasks and projects.

## Acceptance Criteria
1. A login endpoint `POST /api/auth/login` exists.
2. It accepts an email and password.
3. It validates the credentials against the stored user data.
4. Upon successful authentication, a JWT is generated and returned to the client.
5. The JWT contains user information like user ID and role.
6. Failed login attempts return an appropriate error message.

## Tasks / Subtasks
- [x] Task 1 (AC: 1, 2): Create the `POST /api/auth/login` endpoint in `AuthController`.
    - [x] Subtask 1.1: Create a `LoginRequest` DTO that accepts `email` and `password`.
- [x] Task 2 (AC: 3): Implement the login logic in `AuthService`.
    - [x] Subtask 2.1: Use `AuthenticationManager` from Spring Security to authenticate the user's credentials.
- [x] Task 3 (AC: 4, 5): Generate and return a JWT.
    - [x] Subtask 3.1: Create a `JwtService` to handle JWT creation and validation.
    - [x] Subtask 3.2: Include `userId` and `role` as claims in the JWT payload.
    - [x] Subtask 3.3: Return the JWT in the response body.
- [x] Task 4 (AC: 6): Handle failed login attempts with an appropriate error response (e.g., 401 Unauthorized).
- [x] Task 5: Add integration tests for the login endpoint.

## Dev Notes

### Backend
- **Endpoint:** `POST /api/auth/login` [Source: `docs/architecture/api-specification.md`]
- **Authentication:** Use Spring Security's `AuthenticationManager` for credential validation.
- **JWT:** A dedicated `JwtService` should be created to manage JWT generation. The token must contain `userId` and `role`. [Source: `docs/architecture/backend-architecture.md`]
- **Error Handling:** Failed authentication should result in a clear error response.

### Testing
- Write integration tests for the login endpoint to cover both successful and failed authentication scenarios. [Source: `docs/architecture/testing-strategy.md`]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-11-05 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-11-06 | 1.1 | Implemented user login feature | James (Developer) |

## QA Results

### Review Date: 2025-11-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation of the user login feature demonstrates good code quality, adhering to a layered architecture and Spring Boot conventions. The separation of concerns between controller, service, and JWT handling is clear.

### Refactoring Performed

No refactoring was performed during this review, as identified areas for improvement are more related to configuration and future enhancements rather than immediate code changes.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Improvements Checklist

- [ ] Externalize `jwt.secret` to environment variables or a secure configuration management system for production.
- [ ] Consider making JWT expiration time configurable.
- [ ] Add dedicated unit tests for `AuthService` and `JwtService` for more granular testing.

### Security Review

The security implementation utilizes Spring Security and JWTs effectively. The `JwtAuthenticationEntryPoint` correctly handles unauthorized access. However, the `jwt.secret` is currently hardcoded in `application.properties`, which is a security risk for production environments.

### Performance Considerations

The performance impact of JWT generation and validation is minimal and acceptable for this feature.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/1.3.User_Login-user-login.yml
Risk profile: N/A (No separate risk profile generated for this review)
NFR assessment: N/A (NFRs assessed as part of overall review)

### Recommended Status

✓ Ready for Done
