# Story 1.7: Password Recovery

## Status
Aprovved

## Story
**As a** user who has forgotten my password,
**I want** to request a password reset link via email,
**so that** I can regain access to my account.

## Acceptance Criteria
1.  A "Forgot Password?" link is available on the login page.
2.  Clicking the link takes the user to a page where they can enter their email address.
3.  Submitting the email triggers a backend process to send a password reset email if the user exists.
4.  The email contains a unique, time-limited link to a password reset page.
5.  The password reset page allows the user to enter and confirm a new password.
6.  The new password must meet the application's security requirements.
7.  Submitting the new password updates the user's password in the database.
8.  The reset link/token is invalidated after use or expiration.

## Tasks / Subtasks
- [ ] Task 1 (Frontend - AC: 1, 2): Create the "Forgot Password" page.
    - [ ] Subtask 1.1: Add a "Forgot Password?" link to the `LoginPage` component.
    - [ ] Subtask 1.2: Create a `ForgotPasswordPage` component with a form to enter an email address.
    - [ ] Subtask 1.3: On submission, call a `forgotPassword` method in the `authService`.
- [ ] Task 2 (Frontend - AC: 4, 5, 6): Create the "Reset Password" page.
    - [ ] Subtask 2.1: Create a `ResetPasswordPage` component that accepts a token from the URL.
    - [ ] Subtask 2.2: The page should have a form for entering and confirming a new password.
    - [ ] Subtask 2.3: On submission, call a `resetPassword` method in the `authService` with the token and new password.
- [ ] Task 3 (Backend - AC: 3, 4): Implement the forgot password endpoint.
    - [ ] Subtask 3.1: Create a `POST /api/auth/forgot-password` endpoint in `AuthController`.
    - [ ] Subtask 3.2: In `AuthService`, implement logic to generate a secure, time-limited (e.g., 1 hour) password reset token.
    - [ ] Subtask 3.3: Store the token and its expiry, associated with the user.
    - [ ] Subtask 3.4: Integrate an email service to send the password reset link to the user's email.
- [ ] Task 4 (Backend - AC: 5, 6, 7, 8): Implement the reset password endpoint.
    - [ ] Subtask 4.1: Create a `POST /api/auth/reset-password` endpoint in `AuthController`.
    - [ ] Subtask 4.2: Create a `ResetPasswordRequest` DTO accepting `token` and `newPassword`.
    - [ ] Subtask 4.3: In `AuthService`, validate the token, update the user's password (hashed), and invalidate the token.
- [ ] Task 5: Add integration tests for the password recovery flow.

## Dev Notes

### Frontend
- **Routing:** Add new routes for `/forgot-password` and `/reset-password/:token`.
- **UI:** The new pages should align with the existing UI style.
- **Error Handling:** Provide clear feedback to the user (e.g., "If an account with that email exists, a reset link has been sent.").

### Backend
- **Email Service:** An email service (e.g., SendGrid, Mailgun, or a mock for local dev) needs to be configured.
- **Security:**
    - The password reset token must be securely generated and stored.
    - The token must have a short expiration time to minimize risk.
    - The token must be invalidated immediately after use.
- **Configuration:** The frontend URL for the reset link should be configurable.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-11-06 | 1.0 | Initial draft | John (Product Manager) |

## QA Results
*This section will be filled out upon completion and review of the story.*
