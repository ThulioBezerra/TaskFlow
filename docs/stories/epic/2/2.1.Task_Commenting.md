# Story 2.1: Task Commenting

## Status
Draft

## Story
**As an** authenticated user,
**I want** to add comments to tasks,
**so that** I can communicate and collaborate with my team members about specific tasks.

## Acceptance Criteria
1. The task detail view includes a section for comments.
2. Users can type and submit new comments.
3. Comments are displayed chronologically, showing the author and timestamp.
4. Comments are persisted to the database.
5. Real-time updates ensure new comments appear for all active users viewing the task.

## Tasks / Subtasks
- [ ] Task 1 (Frontend - AC: 1, 3): Implement a `CommentsSection` component within the `TaskDetailsModal`.
    - [ ] Subtask 1.1: Display existing comments, showing author, content, and timestamp.
- [ ] Task 2 (Frontend - AC: 2, 5): Implement a form within the `CommentsSection` to allow users to add new comments.
    - [ ] Subtask 2.1: On submission, call a `addCommentToTask` method in the `taskService`.
    - [ ] Subtask 2.2: Update the local state to display the new comment immediately.
- [ ] Task 3 (Backend - AC: 4, 5): Implement the `POST /api/tasks/{taskId}/comments` endpoint.
    - [ ] Subtask 3.1: Create a `CommentService` to handle comment creation and retrieval.
    - [ ] Subtask 3.2: The endpoint should accept comment content and associate it with the authenticated user and the specified task.
    - [ ] Subtask 3.3: Persist the new comment to the database.
- [ ] Task 4 (Backend - AC: 1, 3): Implement the `GET /api/tasks/{taskId}/comments` endpoint.
    - [ ] Subtask 4.1: Retrieve all comments for a given task.

## Dev Notes

### Frontend
- **Component:** A `CommentsSection` component will be needed within the `TaskDetailsModal`. [Source: `docs/architecture/components.md`]
- **Data Flow:** New comments should be displayed in real-time. Consider using WebSockets for this if real-time updates are critical, otherwise a polling mechanism or re-fetching comments after submission will suffice for MVP. [Source: `docs/architecture/core-workflows.md`]

### Backend
- **Endpoint:** New `POST /api/tasks/{taskId}/comments` and `GET /api/tasks/{taskId}/comments` endpoints are required. [Source: `docs/architecture/api-specification.md`]
- **Service Logic:** A `CommentService` will be responsible for handling comment-related business logic. [Source: `docs/architecture/backend-architecture.md`]
- **Data Model:** The `Comment` entity will be used. It has relationships with `Task` and `User`. [Source: `docs/architecture/data-models.md`]

### Testing
- **Backend:** Integration tests for the `CommentController` (once created) and unit tests for the `CommentService` should be written. [Source: `docs/architecture/testing-strategy.md`]
- **Frontend:** Component tests for the `CommentsSection` and integration tests for adding and displaying comments should be created. [Source: `docs/architecture/testing-strategy.md`]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-11-06 | 1.0 | Initial draft | Bob (Scrum Master) |
