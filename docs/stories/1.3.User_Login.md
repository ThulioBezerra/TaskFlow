# Story 1.3: User Login

## Status
Approved

## Story
**As a** registered user,
**I want** to log in with my email and password,
**so that** I can access my tasks and projects.

## Acceptance Criteria
1. A login endpoint `POST /api/auth/login` exists.
2. It accepts an email and password.
3. It validates the credentials against the stored user data.
4. Upon successful authentication, a JWT is generated and returned to the client.
5. The JWT contains user information like user ID and role.
6. Failed login attempts return an appropriate error message.

## Tasks / Subtasks
- [ ] Task 1 (AC: 1, 2): Create the `POST /api/auth/login` endpoint in `AuthController`.
    - [ ] Subtask 1.1: Create a `LoginRequest` DTO that accepts `email` and `password`.
- [ ] Task 2 (AC: 3): Implement the login logic in `AuthService`.
    - [ ] Subtask 2.1: Use `AuthenticationManager` from Spring Security to authenticate the user's credentials.
- [ ] Task 3 (AC: 4, 5): Generate and return a JWT.
    - [ ] Subtask 3.1: Create a `JwtService` to handle JWT creation and validation.
    - [ ] Subtask 3.2: Include `userId` and `role` as claims in the JWT payload.
    - [ ] Subtask 3.3: Return the JWT in the response body.
- [ ] Task 4 (AC: 6): Handle failed login attempts with an appropriate error response (e.g., 401 Unauthorized).
- [ ] Task 5: Add integration tests for the login endpoint.

## Dev Notes

### Backend
- **Endpoint:** `POST /api/auth/login` [Source: `docs/architecture/api-specification.md`]
- **Authentication:** Use Spring Security's `AuthenticationManager` for credential validation.
- **JWT:** A dedicated `JwtService` should be created to manage JWT generation. The token must contain `userId` and `role`. [Source: `docs/architecture/backend-architecture.md`]
- **Error Handling:** Failed authentication should result in a clear error response.

### Testing
- Write integration tests for the login endpoint to cover both successful and failed authentication scenarios. [Source: `docs/architecture/testing-strategy.md`]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-11-05 | 1.0 | Initial draft | Bob (Scrum Master) |
